<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div class="form">
        <ul class="tab_button_wrapper">
            <li class="tab_button active" id="tab_1_button" value="#tab_1">
                <p>
                    Добавление классов
                </p>
            </li>
            <li class="tab_button" id="tab_2_button" value="#tab_2">
                <p>
                    Текущие классы
                </p>
            </li>
            <li class="tab_button" id="tab_3_button" value="#tab_3">
                <p>
                    Определение классов
                </p>
            </li>
        </ul>

        <div class="tab_wrapper" id="tab_1">
            <div action="/fit" class="form__content">
                <h1>Название класса</h1>
                <div class="form__box">
                    <input name="class__input" type="text" class="form__input" placeholder="Ввод названия">
                    <label for="class__input" class="form__label">Название класса</label>
                    <div class="form__shadow"></div>
                </div>
                <div class="form__button">
                    <button class="form__submit" id="add_class_button">Отправить</button>
                </div>
            </div>
        </div>

        <div class="tab_wrapper" id="tab_2">
            <table class="form__box">
                <tr>
                    <td>1.</td>
                    <td>Class 1</td>
                </tr>
                <tr>
                    <td>2.</td>
                    <td>Class 2</td>
                </tr>
                <tr>
                    <td>3.</td>
                    <td>Class 3</td>
                </tr>
                <tr>
                    <td>4.</td>
                    <td>Class 4</td>
                </tr>
                <tr>
                    <td>5.</td>
                    <td>Class 5</td>
                </tr>
                <tr>
                    <td>6.</td>
                    <td>Class 6</td>
                </tr>
                <tr>
                    <td>7.</td>
                    <td>Class 7</td>
                </tr>
                <tr>
                    <td>8.</td>
                    <td>Class 8</td>
                </tr>
                <tr>
                    <td>9.</td>
                    <td>Class 9</td>
                </tr>
                <tr>
                    <td>10.</td>
                    <td>Class 10</td>
                </tr>
            </table>
        </div>

        <div class="tab_wrapper" id="tab_3">
            <form action="#" id="file_form" class="form__content">
                <h1>FILES</h1>
                <div class="form__box">
                    <input style="padding-bottom: 35px;" name="file__input" type="file" class="form__input" placeholder="Загрузка файлов" multiple>
                    <label for="file__input" class="form__label">Загрузка файлов</label>
                    <div class="form__shadow"></div>
                </div>
        
                <div style="margin-top: 8px;" class="form__button">
                    <button type="submit" class="form__submit" id="send_images_button">Отправить</button>
                </div>
            </form>
        </div>
    </div>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script type="module">

    const fireAlert = (icon, text, timer) => {
        Swal.fire({
            icon: icon,
            title: text,
            showConfirmButton: false,
            timer: timer
        })
    }

    $.ajax({
        url: "/status",
        type: 'GET',
        dataType: 'json',
        success: function(res) {
            let tableContent = ''
            for (let x = 0; x < Object.keys(res.data["CLASSES"]).length; x++) {
                tableContent += `
                    <tr>
                        <td>${x+1}</td>
                        <td>${res.data["CLASSES"][x].toLocaleUpperCase()}</td>
                    </tr>
                `
            }
            $('table').empty().append(tableContent);
        }
    });

    $('.tab_button').click((e) => {
        e.target.classList.add('active');
        $(e.target.attributes.value.nodeValue).show();
        for (let x = 0; x < e.target.parentElement.children.length; x++) {
            if (e.target.parentElement.children[x] != e.target) {
                e.target.parentElement.children[x].classList.remove('active');
                $(e.target.parentElement.children[x].attributes.value.nodeValue).hide();
            }            
        }
    });

    $('#add_class_button').click(() => {
        e.preventDefault();
        $.ajax({
            url: "/fit",
            type: 'GET',
            data: {
                something: $('input[name="class__input"]').val(),
            },
            dataType: 'json',
            success: function(res) {
                fireAlert('success', 'Новый класс загружен! Дождитесь переобучения модели, пожалуйста!', 3500);
            }
        });
    });

    $('#send_images_button').click((e) => {
        e.preventDefault();

        const images = {};

        const promise1 = new Promise((resolve, reject) => {

            for (let x = 0; x < $('input[name="file__input"]')[0].files.length; x++) {
                let reader = new FileReader();
                reader.readAsDataURL($('input[name="file__input"]')[0].files[x]);
                reader.onload = () => {
                    images[$('input[name="file__input"]')[0].files[0].name] = (reader.result).split(',')[1];
                }
            }

            resolve();
        });

        while (!images[$('input[name="file__input"]')[0].files.length]) {
            console.log('no');
        }

        promise1.then(() => {
            console.log(images);
        })
        
        $.ajax({
            url: "/predict",
            type: 'POST',
            contentType: 'application/json',
            data:  images,
            dataType: 'json',
            success: function(res) {
                fireAlert('success', 'Файлы загружены! Дождитесь окончания классификация, пожалуйста!', 3500);
            }
        });
    });

</script>

<style>

@import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');

:root {
    --white-color: #fff;
    --black-color: #000;
    --body-font: "Poppins", sans-serif;
    --normal-font-size: 1rem;
    --tiny-font-size: 0.6rem;
}

@media screen and (min-width: 968px) {
  :root {
        --normal-font-size: 1rem;
  }
}

* {
    padding: 0;
    margin: 0;
    box-sizing: border-box;
    list-style: none;
}

body {
    width: 100%;
    height: 100%;
    font-family: var(--body-font);
    font-size: var(--normal-font-size);
    background-color: var(--white-color);
}

.tab_button_wrapper {
    display: grid;
    margin-top: -30%;
}

.tab_button {
    cursor: pointer;
    margin: 5% 0;
    padding: 3% 3%;
    text-align: center;
    border: thin solid black;
}

.tab_button p {
    pointer-events: none;
}

.tab_wrapper {
    margin-top: -100%;
    display: none;
}

#tab_1 {
    display: block;
}

.form {
    position: relative;
    max-width: fit-content;
    min-height: 100vh !important;
    display: grid;
    place-items: center;
    margin: 0 1.5rem;
    border-right: 2.5px solid var(--black-color);
}

.form__content {
    display: grid;
    row-gap: 1.5rem;
    padding: 2rem;
}

h1 {
    position: relative;
    display: grid;
    place-items: center;
    place-content: center;
}

.form__input,
.form__label,
.form__submit {
    border: 0;
    outline: none;
    font-size: var(--normal-font-size);
    font-family: var(--body-font);
    vertical-align: middle;
}

.form__box {
    width: 19.5rem;
    height: 3.75rem;
    position: relative;
}

.form__shadow {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 0.25rem;
    background-color: var(--black-color);
}

.form__input {
    vertical-align: middle;
    position: absolute;
    border: 2.5px solid var(--black-color);
    background-color: var(--white-color);
    border-radius: 0.25rem;
    width: 100%;
    height: 100%;
    z-index: 10;
    padding: 1.125rem;
    transition: transform 0.3s;
}

.form__input::placeholder {
    transition: opacity 0.5s;
}

.form__label {
    z-index: 100;
    position: absolute;
    top: 1rem;
    left: 1.25rem;
    font-size: var(--tiny-font-size);
    font-weight: 600;
    transition: 0.2s;
    pointer-events: none;
    opacity: 0;
}

.form__button {
    justify-self: center;
    border-radius: 0.25rem;
    background-color: var(--black-color);
}

.form__submit {
    padding: 0.875rem 2.5rem;
    color: var(--black-color);
    border: 2.5px solid var(--black-color);
    background-color: var(--white-color);
    border-radius: 0.25rem;
    transition: transform 0.3s;
    transform: translate(-6px, -6px);
    cursor: pointer;
}

.form__submit:hover {
    border: 2.5px solid var(--black-color);
    transform: translate(0px);
}

.form__input:focus::placeholder {
    opacity: 0;
    transition: 0.3s;
}

.form__input:focus,
.form__input:not(:placeholder-shown).form__input:not(:focus) {
    padding: 28px 18px 18px;
}

.form__input:focus + .form__label,
.form__input:not(:placeholder-shown).form__input:not(:focus) + .form__label {
    opacity: 1;
    top: 6px;
    left: 12px;
    transition: 0.3s;
}

table {
    margin-top: -50%;
    display: grid;
    justify-content: center;
}

@media screen and (max-width: 401px) {
    .form__content,
    .form__box {
        width: 100%;
    }
}

@media screen and (min-width: 968px) {
    .form__content {
        zoom: 1.1;
    }
}

</style>
</html>